<!--
  Wazuh - Agent - Universal Configuration for Rocky Linux, Debian, and Ubuntu
  Keep only stable, agent-specific settings here
-->

<ossec_config>
  <!-- CLIENT CONNECTION -->
  <client>
    <server>
      <address>Worker_IP</address>
      <port>1514</port>
      <protocol>tcp</protocol>
    </server>
    <config-profile>linux, rocky, debian, ubuntu</config-profile>
    <notify_time>10</notify_time>
    <time-reconnect>60</time-reconnect>
    <auto_restart>yes</auto_restart>
    <crypto_method>aes</crypto_method>
    <enrollment>
      <enabled>yes</enabled>
      <authorization_pass_path>/var/ossec/etc/authd.pass</authorization_pass_path>
    </enrollment>
  </client>

  <!-- BUFFER SETTINGS -->
  <client_buffer>
    <disabled>no</disabled>
    <queue_size>10000</queue_size>
    <events_per_second>1000</events_per_second>
  </client_buffer>

  <!-- UNIVERSAL CORE LOGS (Present on all systems) -->
  <localfile>
    <log_format>syslog</log_format>
    <location>/var/log/dpkg.log</location>
  </localfile>

  <!-- Journald (Universal across modern Linux) -->
  <localfile>
    <log_format>journald</log_format>
    <location>journald</location>
  </localfile>

  <!-- Audit logs (if available) -->
  <localfile>
    <log_format>audit</log_format>
    <location>/var/log/audit/audit.log</location>
  </localfile>

  <!-- Basic command monitoring -->
  <localfile>
    <log_format>command</log_format>
    <command>df -P</command>
    <frequency>300</frequency>
    <alias>disk_space</alias>
  </localfile>

  <!-- SYSTEM COLLECTOR -->
  <wodle name="syscollector">
    <disabled>no</disabled>
    <interval>1h</interval>
    <scan_on_start>yes</scan_on_start>
    <hardware>yes</hardware>
    <os>yes</os>
    <network>yes</network>
    <packages>yes</packages>
    <ports all="yes">yes</ports>
    <processes>yes</processes>
    <synchronization>
      <max_eps>20</max_eps>
    </synchronization>
  </wodle>

  <!-- ACTIVE RESPONSE -->
  <command>
    <name>remove-threat</name>
    <executable>remove-threat</executable>
    <timeout_allowed>yes</timeout_allowed>
  </command>

  <!-- OPTIONAL MODULES -->
  <wodle name="osquery">
    <disabled>yes</disabled>
    <run_daemon>yes</run_daemon>
    <log_path>/var/log/osquery/osqueryd.results.log</log_path>
    <config_path>/etc/osquery/osquery.conf</config_path>
    <add_labels>yes</add_labels>
  </wodle>

  <wodle name="cis-cat">
    <disabled>yes</disabled>
    <timeout>1800</timeout>
    <interval>1d</interval>
    <scan-on-start>yes</scan-on-start>
    <java_path>wodles/java</java_path>
    <ciscat_path>wodles/ciscat</ciscat_path>
  </wodle>

  <!-- LOGGING -->
  <logging>
    <log_format>plain</log_format>
  </logging>

</ossec_config>
